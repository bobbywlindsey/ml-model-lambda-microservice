{
  "Resources": {

    "JoblibLayer": {
      "Type": "AWS::Lambda::LayerVersion",
      "Properties": {
          "CompatibleRuntimes": [
              "python3.7"
          ],
          "Content": {
              "S3Bucket": "bobbywlindseytest",
              "S3Key": "joblib-layer.zip"
          },
          "Description": "Joblib layer",
          "LayerName": "joblib-layer",
          "LicenseInfo": "MIT"
      }
    },

    "ScikitLearnLayer": {
      "Type": "AWS::Lambda::LayerVersion",
      "Properties": {
          "CompatibleRuntimes": [
              "python3.7"
          ],
          "Content": {
              "S3Bucket": "bobbywlindseytest",
              "S3Key": "sklearn-layer.zip"
          },
          "Description": "Scikitlearn layer",
          "LayerName": "scikit-learn-layer",
          "LicenseInfo": "MIT"
      }
    },
    
    "LambdaRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "RoleName": "test-lambda-role-for-bobby",
        "AssumeRolePolicyDocument": {
          "Version" : "2012-10-17",
          "Statement": [ {
            "Effect": "Allow",
            "Principal": {
               "Service": ["lambda.amazonaws.com"]
            },
            "Action": ["sts:AssumeRole"]
         } ]
         },
        "Path": "/",
        "ManagedPolicyArns": [
          "arn:aws:iam::aws:policy/AWSLambdaExecute"
        ]
      }
    },

    "MyModel": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Handler": "function.lambda_handler",
        "FunctionName" : "test-model-bobby",
        "Code": {
          "S3Bucket": "bobbywlindseytest",
          "S3Key": "function.zip"
        },
        "Layers": [
          {"Ref": "JoblibLayer"},
          "arn:aws:lambda:us-east-1:668099181075:layer:AWSLambda-Python37-SciPy1x:2",
          {"Ref": "ScikitLearnLayer"}
        ],
        "Description": "cfn-create-lambda-test-bobby",
        "Role": {  
          "Fn::GetAtt":[  
             "LambdaRole",
             "Arn"
          ]},
        "Runtime": "python3.7",
        "MemorySize": 192,
        "Timeout": 60
      },
      "Metadata": {
        "Lambda": {
          "Description": "Lambda function test for Bobby Lindsey"
        }
      }
    }
  }
}